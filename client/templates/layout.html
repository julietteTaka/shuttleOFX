<!doctype>
<html lang="en">
<title>Plugins !</title>

<head>

  <!-- Styles -->
  <link href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700' rel='stylesheet' type='text/css'>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/vendor/bootstrap.css') }}">
  <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/vendor/material.css') }}"> -->
  <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/vendor/material-wfont.css') }}"> -->
  <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/vendor/ripples.css') }}"> -->
  <!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/vendor/jquery.nouislider.min.css') }}"> -->



  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/main.css') }}">


</head>

<body>

<!-- <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/plugins">Web OpenFX</a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="/plugins">Home</a></li>
                <li class="active"><a href="/plugins">Plugins documentation</a></li>
            </ul>
            <form class="navbar-form navbar-right" role="search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search">
                </div>
                <button type="submit" class="btn btn-default glyphicon glyphicon-search"></button>
            </form>
            <p class="navbar-text pull-right">Signed in as Armand Biteau</p>
        </div>
    </div>
</nav> -->


<nav id="main-nav" class="navigation overflow">
    <div id="left-nav">
        <div class="logo">
            <img src="http://placehold.it/265x80/ddd/fff&text=OpenFX%20Plateform" alt="" class="img-responsive">
        </div>
        <ul>

            <li>
                <img class="signedIn" src="http://loremflickr.com/100/100/">
                <a href='#' class="signedIn">Settings <b class="caret"></b></a>
                <p class="signedIn">Signed in as armandbiteau</p>
            </li>


            <li class="title-nav"><h4>NAVIGATION</h4></li>

            <!-- <li>
                <a href='#'><i class="fa fa-user"></i>Personnal account</a>
                <ul>
                    <li><a href="#">Profile</a></li>
                    <li><a href="#">Plugins</a></li>
                    <li><a href="#">Bundles</a></li>
                </ul>
            </li> -->

            <li>
                <a href='/upload'><i class="fa fa-cloud-upload"></i>Upload new plugins</a>
            </li>
            <li class="active">
                <a href='/plugins'><i class="fa fa-crop"></i>Explore plugins</a>
                <!-- <ul>
                    <li><a href="/plugins">View all plugins</a></li>
                    <li><a href="/plugins">Search a plugin</a></li>
                </ul> -->
            </li>
            <li>
                <a href='/demo'><i class="fa fa-photo"></i>Get a render</a>
            </li>
            <li class="title-nav"><h4>MORE</h4></li>
            <li>
                <a href='#'><i class="fa fa-sitemap"></i>About the plateform</a>
                <ul>
                    <li><a href="#">About us</a></li>
                    <li><a href="#">Plateform authors</a></li>
                </ul>
            </li>
            <li>
                <a href='http://www.openeffects.org' target="_blank"><i class="fa fa-share-alt"></i>OFX community</a>
            </li>
        </ul>
        <div class="legacy">
           <p class="legacy-title">WebOpenFX Â©</p>
           <p class="legacy-links"><a href="#">Privacy</a> & <a href="#">Terms</a></p>

        </div>
    </div>
</nav>

    <div id="container">

        <header class="header">
            <span class="open icon">&#9776;</span>
                <div class="navbar search-bar">
                        

                       <!--  <ul class="nav navbar-nav navbar-left desktop">
                            <li class="dropdown">
                                <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown">Settings <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    <li><a href="javascript:void(0)">Action</a></li>
                                    <li><a href="javascript:void(0)">Another action</a></li>
                                    <li><a href="javascript:void(0)">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li><a href="javascript:void(0)">Separated link</a></li>
                                </ul>
                            </li>
                        </ul>
                        -->
                        <form id="searchForm">
                              <input type="text" placeholder="Search" id="query" />
                              <button type="submit" value="Submit query"><i class="fa fa-search"></i></button>
                        </form>
                </div>


                {% block title %}{% endblock %}

                {% block subtitle %}{% endblock %}

        </header>


        <section id="scroller">


        <div class="main" data-0="padding-top:350px" data-150="padding-top: 300px">


            {% block content %}{% endblock %}


        </div>


        </section>


    </div>

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="{{ url_for('static', filename='scripts/vendor/ripples.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/vendor/material.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/vendor/dropzone.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/vendor/jquery.nouislider.min.js') }}"></script>

    <script src="{{ url_for('static', filename='scripts/scripts.js') }}"></script>
    <!-- // <script src="{{ url_for('static', filename='scripts/render.js') }}"></script> -->



    <script type="text/javascript">


    $(document).ready(function() {

    var site = new Bamboo({
        menu: true,
        breakpoint: 768,
        menuWidth: 265,
        headerHeight: 50,
        resize: function(){
        }
    });


    $.material.init();

    $("#left-nav a").click(function(){
        $("#left-nav ul ul").slideUp();
        if(!$(this).next().is(":visible"))
        {
            $(this).next().slideDown();
        }
    });


    var marginTopInput = 30;
    var count = 1;
    var numItemsInput = $('.clip-input').length + 1;
    $('.clip').css( "height", marginTopInput*numItemsInput);
    $('.clip .clip-name').css( "line-height", $('.clip').height() + "px");


    $( ".clip-input" ).each(function( i ) {
        // marginTopInput = marginTopInput / numItemsInput;
        $( this ).css( "marginTop", marginTopInput*count -15);
        count += 1;
    });


    $( ".clip-output" ).each(function( i ) {
        $( this ).css( "marginTop", $('.clip').height()/2 -15);
    });


    $('.clip-input').popover();
    $('.clip-output').popover();
    $('.clip-mask').popover();



    function formToJson()
    {
        var renderParameters = [];
        $("input", $('#renderForm')).each(function(index){
            var jsonForm={};
            // console.log(this.type);
            switch($(this).attr("ofxType")) {
            // switch(this.type) {
                case 'OfxParamTypeInteger':
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = parseInt(this.value);
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeInteger2D':
                    var tab = [];
                    tab.push(4);
                    tab.push(4);
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = tab;
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeRange':
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = parseInt(this.value);
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeText':
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = this.value;
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeDouble':
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = parseFloat(this.value);
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeString':
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = this.value;
                    renderParameters.push(jsonForm);
                    break;
                case 'OfxParamTypeBoolean':
                    if (this.checked) {
                        jsonForm["id"] = $(this).attr("id");
                        jsonForm["value"] = true;
                        renderParameters.push(jsonForm);
                    }else{
                        jsonForm["id"] = $(this).attr("id");
                        jsonForm["value"] = false;
                        renderParameters.push(jsonForm);
                    };
                    break;
                default:
                    jsonForm["id"] = $(this).attr("id");
                    jsonForm["value"] = this.value;
                    renderParameters.push(jsonForm);
                    break;
            }
        });

        $("select", $('#renderForm')).each(function(index){
            var jsonForm={};
            jsonForm["id"] = $(this).attr("id");
            jsonForm["value"] = this.value;
            renderParameters.push(jsonForm);
        });

        return renderParameters;
    }



    $("#render.OfxImageEffectContextGenerator").click(function(){
        var pluginId = $(this).attr("pluginId");
        console.log('Generator: ' + pluginId );
        var renderParameters = formToJson();

        console.log(renderParameters);
        // $('#resultForm').text(JSON.stringify(renderParameters));

        $.ajax({
            type: "POST",
            url: "/render",
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({
                nodes: [{
                    id: 0,
                    plugin: pluginId,
                    parameters: renderParameters
                },{
                    id: 1,
                    plugin: "tuttle.pngwriter",
                    parameters: []
                }],

                connections: [{
                        src: {id: 0},
                        dst: {id: 1}
                }],
                renderNode: {id: 1}
            }),
        })
        .done(function(data){
            console.log('POST DONE !');
            $("#viewer img").attr("src", "/resource/"+data.render.outputFile);
            $("#download-view").attr("href", "/resource/"+data.render.outputFile);
            $("#download-view").removeClass('disabled');
        })
        .error(function(data){
            console.log('POST ERROR !');
        })
    });

    $("#render.OfxImageEffectContextFilter").click(function(){
        var pluginId = $(this).attr("pluginId");
        console.log('Filter: ' + pluginId );
        var renderParameters = formToJson();

        console.log(renderParameters);
        // $('#resultForm').text(JSON.stringify(renderParameters));

        $.ajax({
            type: "POST",
            url: "/render",
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({
                nodes: [{
                    id: 0,
                    plugin: "tuttle.jpegreader",
                    parameters: [
                        {
                            "id" : "filename",
                            "value" : "/home/hugo/WebOpenFX/github/server/resources/lol.jpg"
                        }
                    ]
                },                {
                    id: 1,
                    plugin: pluginId,
                    parameters: renderParameters
                },{
                    id: 2,
                    plugin: "tuttle.pngwriter",
                    parameters: []
                }],

                connections: [{
                        src: {id: 0},
                        dst: {id: 1}
                },{
                        src: {id: 1},
                        dst: {id: 2}
                }],
                renderNode: {id: 2}
            }),
        })
        .done(function(data){
            console.log('POST DONE !');
            $("#viewer img").attr("src", "/resource/"+data.render.outputFile);
            $("#download-view").attr("href", "/resource/"+data.render.outputFile);
            $("#download-view").removeClass('disabled');
            // console.log(data.render.outputFile);
        })
        .error(function(data){
            console.log('POST ERROR !');
        })
    });




    });

    </script>


</body>
</html>